import{_ as $,c as n,a as d,b as t,F as y,f as C,g as u,t as h,w as v,v as x,h as V,r as g,o as r,q as S,i as f,n as b}from"./index.b47f3273.js";const M={data(){return{products:[],product:{},status:{loadingItem:""},form:{user:{name:"",email:"",tel:"",address:""},message:""},cart:{},isLoading:!1,coupon_code:""}},methods:{getProducts(){const l="https://vue3-course-api.hexschool.io/v2//api/hexschoolvue/products";this.isLoading=!0,this.$http.get(l).then(e=>{this.products=e.data.products,this.isLoading=!1}).catch(e=>{this.isLoading=!1,this.$httpMessageState(e.response,"\u932F\u8AA4\u8A0A\u606F")})},getProduct(l){this.$router.push(`/user/product/${l}`)},addToCart(l,e=1){this.isLoading=!0;const a="https://vue3-course-api.hexschool.io/v2//api/hexschoolvue/cart";this.status.loadingItem=l;const p={product_id:l,qty:e};this.$http.post(a,{data:p}).then(o=>{this.status.loadingItem="",this.isLoading=!1,this.$httpMessageState(o,"\u52A0\u5165\u8CFC\u7269\u8ECA"),this.getCart()}).catch(o=>{this.isLoading=!1,this.$httpMessageState(o.response,"\u932F\u8AA4\u8A0A\u606F")})},deleteAllCarts(){this.isLoading=!0;const l="https://vue3-course-api.hexschool.io/v2//api/hexschoolvue/carts";this.$http.delete(l).then(e=>{this.$httpMessageState(e,"\u6E05\u9664\u8CFC\u7269\u8ECA"),this.getCart(),this.isLoading=!1}).catch(e=>{this.isLoading=!1,this.$httpMessageState(e.response,"\u6E05\u9664\u8CFC\u7269\u8ECA")})},getCart(){const l="https://vue3-course-api.hexschool.io/v2//api/hexschoolvue/cart";this.isLoading=!0,this.$http.get(l).then(e=>{this.cart=e.data.data,this.isLoading=!1}).catch(e=>{this.isLoading=!1,this.$httpMessageState(e.response,"\u932F\u8AA4\u8A0A\u606F")})},removeCartItem(l){this.status.loadingItem=l;const e=`https://vue3-course-api.hexschool.io/v2//api/hexschoolvue/cart/${l}`;this.isLoading=!0,this.$http.delete(e).then(a=>{this.$httpMessageState(a,"\u79FB\u9664\u8CFC\u7269\u8ECA\u54C1\u9805"),this.status.loadingItem="",this.isLoading=!1,this.getCart()}).catch(a=>{this.isLoading=!1,this.$httpMessageState(a.response,"\u79FB\u9664\u8CFC\u7269\u8ECA\u54C1\u9805")})},updateCart(l){this.isLoading=!0;const e=`https://vue3-course-api.hexschool.io/v2//api/hexschoolvue/cart/${l.id}`,a={product_id:l.product_id,qty:l.qty};this.$http.put(e,{data:a}).then(p=>{this.$httpMessageState(p,"\u66F4\u65B0\u8CFC\u7269\u8ECA"),this.isLoading=!1,this.getCart()}).catch(p=>{this.isLoading=!1,this.$httpMessageState(p.response,"\u66F4\u65B0\u8CFC\u7269\u8ECA")})},addCouponCode(){const l="https://vue3-course-api.hexschool.io/v2//api/hexschoolvue/coupon",e={code:this.coupon_code};this.isLoading=!0,this.$http.post(l,{data:e}).then(a=>{this.$httpMessageState(a,"\u52A0\u5165\u512A\u60E0\u5238"),this.getCart(),this.isLoading=!1}).catch(a=>{this.isLoading=!1,this.$httpMessageState(a.response,"\u52A0\u5165\u512A\u60E0\u5238")})},createOrder(){this.isLoading=!0;const l="https://vue3-course-api.hexschool.io/v2//api/hexschoolvue/order",e=this.form;this.$http.post(l,{data:e}).then(a=>{this.$httpMessageState(a,"\u5EFA\u7ACB\u8A02\u55AE"),this.$router.push(`/user/checkout/${a.data.orderId}`),this.$refs.form.resetForm(),this.isLoading=!1}).catch(a=>{this.isLoading=!1,this.$httpMessageState(a.response,"\u5EFA\u7ACB\u8A02\u55AE")})}},created(){this.getProducts(),this.getCart()}},I={class:"container"},U={class:"mt-4"},q={class:"table align-middle"},w=t("thead",null,[t("tr",null,[t("th",null,"\u5716\u7247"),t("th",null,"\u5546\u54C1\u540D\u7A31"),t("th",null,"\u50F9\u683C"),t("th",null,"\u529F\u80FD")])],-1),F={style:{width:"200px"}},B={href:"#",class:"text-dark"},E={key:0,class:"h5"},z={key:1,class:"h6"},N={key:2,class:"h5"},P={class:"btn-group btn-group-sm"},T=["disabled","onClick"],A={key:0,class:"spinner-border spinner-grow-sm"},D=f(" \u67E5\u770B\u66F4\u591A "),O=["onClick","disabled"],j={key:0,class:"spinner-border spinner-grow-sm"},G=f(" \u52A0\u5230\u8CFC\u7269\u8ECA "),H={class:"text-end"},J={class:"table align-middle"},K=t("thead",null,[t("tr",null,[t("th"),t("th",null,"\u54C1\u540D"),t("th",{style:{width:"110px"}},"\u6578\u91CF"),t("th",null,"\u55AE\u50F9")])],-1),Q=["disabled","onClick"],R=t("i",{class:"bi bi-x"},null,-1),W=[R],X={key:0,class:"text-success"},Y={class:"input-group input-group-sm"},Z=["onUpdate:modelValue","onBlur"],tt={class:"input-group-text"},st={class:"text-end"},et={key:0,class:"text-success"},ot=t("td",{colspan:"3",class:"text-end"},"\u7E3D\u8A08",-1),lt={class:"text-end"},at={key:0},it=t("td",{colspan:"3",class:"text-end text-success"},"\u6298\u6263\u50F9",-1),nt={class:"text-end text-success"},rt={class:"input-group mb-3 input-group-sm"},dt={class:"input-group-append"},ct={class:"my-5 row justify-content-center"},ut={class:"mb-3"},ht=t("label",{for:"email",class:"form-label"},"Email",-1),pt={class:"mb-3"},_t=t("label",{for:"name",class:"form-label"},"\u6536\u4EF6\u4EBA\u59D3\u540D",-1),mt={class:"mb-3"},gt=t("label",{for:"tel",class:"form-label"},"\u6536\u4EF6\u4EBA\u96FB\u8A71",-1),bt={class:"mb-3"},ft=t("label",{for:"address",class:"form-label"},"\u6536\u4EF6\u4EBA\u5730\u5740",-1),vt={class:"mb-3"},xt=t("label",{for:"message",class:"form-label"},"\u7559\u8A00",-1),yt=t("div",{class:"text-end"},[t("button",{class:"btn btn-danger"},"\u9001\u51FA\u8A02\u55AE")],-1);function Ct(l,e,a,p,o,c){const k=g("Loading"),_=g("Field"),m=g("ErrorMessage"),L=g("Form");return r(),n("div",I,[d(k,{active:o.isLoading,"z-index":1060},null,8,["active"]),t("div",U,[t("table",q,[w,t("tbody",null,[(r(!0),n(y,null,C(o.products,s=>(r(),n("tr",{key:s.id},[t("td",F,[t("div",{style:S([{height:"100px","background-size":"cover","background-position":"center"},{backgroundImage:`url(${s.imageUrl})`}])},null,4)]),t("td",null,[t("a",B,h(s.title),1)]),t("td",null,[s.price?u("",!0):(r(),n("div",E,h(s.origin_price)+" \u5143 ",1)),s.price?(r(),n("del",z,"\u539F\u50F9 "+h(s.origin_price)+" \u5143",1)):u("",!0),s.price?(r(),n("div",N," \u73FE\u5728\u53EA\u8981 "+h(s.price)+" \u5143 ",1)):u("",!0)]),t("td",null,[t("div",P,[t("button",{type:"button",class:"btn btn-outline-secondary",disabled:o.status.loadingItem===s.id||!s.is_enabled,onClick:i=>c.getProduct(s.id)},[o.status.loadingItem===s.id?(r(),n("span",A)):u("",!0),D],8,T),t("button",{type:"button",class:"btn btn-outline-danger",onClick:i=>c.addToCart(s.id),disabled:o.status.loadingItem===s.id||!s.is_enabled},[o.status.loadingItem===s.id?(r(),n("span",j)):u("",!0),G],8,O)])])]))),128))])]),t("div",H,[t("button",{class:"btn btn-outline-danger",type:"button",onClick:e[0]||(e[0]=(...s)=>c.deleteAllCarts&&c.deleteAllCarts(...s))}," \u6E05\u7A7A\u8CFC\u7269\u8ECA ")]),t("table",J,[K,t("tbody",null,[o.cart.carts?(r(!0),n(y,{key:0},C(o.cart.carts,s=>(r(),n("tr",{key:s.id},[t("td",null,[t("button",{type:"button",class:"btn btn-outline-danger btn-sm",disabled:o.status.loadingItem===s.id,onClick:i=>c.removeCartItem(s.id)},W,8,Q)]),t("td",null,[f(h(s.product.title)+" ",1),s.coupon?(r(),n("div",X,"\u5DF2\u5957\u7528\u512A\u60E0\u5238")):u("",!0)]),t("td",null,[t("div",Y,[v(t("input",{type:"number",class:"form-control",min:"1","onUpdate:modelValue":i=>s.qty=i,onBlur:i=>c.updateCart(s)},null,40,Z),[[x,s.qty,void 0,{number:!0}]]),t("div",tt,"/ "+h(s.product.unit),1)])]),t("td",st,[o.cart.final_total!==o.cart.total?(r(),n("small",et,"\u6298\u6263\u50F9\uFF1A")):u("",!0),f(" "+h(l.$filters.currency(s.final_total)),1)])]))),128)):u("",!0)]),t("tfoot",null,[t("tr",null,[ot,t("td",lt,h(l.$filters.currency(o.cart.total)),1)]),o.cart.final_total!==o.cart.total?(r(),n("tr",at,[it,t("td",nt,h(l.$filters.currency(o.cart.final_total)),1)])):u("",!0)])]),t("div",rt,[v(t("input",{type:"text",class:"form-control","onUpdate:modelValue":e[1]||(e[1]=s=>o.coupon_code=s),placeholder:"\u8ACB\u8F38\u5165\u512A\u60E0\u78BC"},null,512),[[x,o.coupon_code]]),t("div",dt,[t("button",{class:"btn btn-outline-secondary",type:"button",onClick:e[2]||(e[2]=(...s)=>c.addCouponCode&&c.addCouponCode(...s))}," \u5957\u7528\u512A\u60E0\u78BC ")])])]),t("div",ct,[d(L,{ref:"form",class:"col-md-6",onSubmit:c.createOrder},{default:V(({errors:s})=>[t("div",ut,[ht,d(_,{id:"email",name:"email",type:"email",class:b(["form-control",{"is-invalid":s.email}]),placeholder:"\u8ACB\u8F38\u5165 Email",rules:"email|required",modelValue:o.form.user.email,"onUpdate:modelValue":e[3]||(e[3]=i=>o.form.user.email=i)},null,8,["class","modelValue"]),d(m,{name:"email",class:"invalid-feedback"})]),t("div",pt,[_t,d(_,{id:"name",name:"\u59D3\u540D",type:"text",class:b(["form-control",{"is-invalid":s.\u59D3\u540D}]),placeholder:"\u8ACB\u8F38\u5165\u59D3\u540D",rules:"required",modelValue:o.form.user.name,"onUpdate:modelValue":e[4]||(e[4]=i=>o.form.user.name=i)},null,8,["class","modelValue"]),d(m,{name:"\u59D3\u540D",class:"invalid-feedback"})]),t("div",mt,[gt,d(_,{id:"tel",name:"\u96FB\u8A71",type:"tel",class:b(["form-control",{"is-invalid":s.\u96FB\u8A71}]),placeholder:"\u8ACB\u8F38\u5165\u96FB\u8A71",rules:"required|min:8|max:10",modelValue:o.form.user.tel,"onUpdate:modelValue":e[5]||(e[5]=i=>o.form.user.tel=i)},null,8,["class","modelValue"]),d(m,{name:"\u96FB\u8A71",class:"invalid-feedback"})]),t("div",bt,[ft,d(_,{id:"address",name:"\u5730\u5740",type:"text",class:b(["form-control",{"is-invalid":s.\u5730\u5740}]),placeholder:"\u8ACB\u8F38\u5165\u5730\u5740",rules:"required",modelValue:o.form.user.address,"onUpdate:modelValue":e[6]||(e[6]=i=>o.form.user.address=i)},null,8,["class","modelValue"]),d(m,{name:"\u5730\u5740",class:"invalid-feedback"})]),t("div",vt,[xt,v(t("textarea",{name:"",id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":e[7]||(e[7]=i=>o.form.message=i)},null,512),[[x,o.form.message]])]),yt]),_:1},8,["onSubmit"])])])}const Lt=$(M,[["render",Ct]]);export{Lt as default};
